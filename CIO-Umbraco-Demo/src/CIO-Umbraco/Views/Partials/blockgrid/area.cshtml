@using Umbraco.Community.BlockPreview.Extensions
@using Umbraco.Extensions
@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<Umbraco.Cms.Core.Models.Blocks.BlockGridArea>

@{
    var model = Model;
    string? backgroundValue = ViewData["AreaBackgroundColors"]?.ToString();

    static bool IsCssColor(string? value)
        => !string.IsNullOrWhiteSpace(value)
           && (value.StartsWith("#")
               || value.StartsWith("rgb", StringComparison.OrdinalIgnoreCase)
               || value.StartsWith("hsl", StringComparison.OrdinalIgnoreCase)
               || value.StartsWith("var(", StringComparison.OrdinalIgnoreCase));

    var areaClasses = $"blockgrid-area area-{Model.ColumnSpan} {Model.Alias}";
    var styleAttribute = string.Empty;

    if (!string.IsNullOrWhiteSpace(backgroundValue))
    {
        if (IsCssColor(backgroundValue))
        {
            styleAttribute = $"--layout-area-bg: {backgroundValue};";
        }
        else
        {
            areaClasses += $" {backgroundValue}";
        }
    }
    else
    {
        areaClasses += " bg-body";
    }
}

<!-- START - AREA -->
<div class="@areaClasses" style="@styleAttribute">
    @await Html.GetPreviewBlockGridItemsHtmlAsync(Model)
</div>
