@using Umbraco.Community.BlockPreview.Extensions
@using Umbraco.Extensions
@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<Umbraco.Cms.Core.Models.Blocks.BlockGridItem>
@{
    if (Model?.Areas.Any() != true) { return; }

    var dataAreas = string.Join(' ', Model.Areas.Select(a => a.Alias));

    string? layoutAreaBackground = ViewData["AreaBackgroundColors"]?.ToString();

    static bool IsCssColor(string? value)
        => !string.IsNullOrWhiteSpace(value)
           && (value.StartsWith("#")
               || value.StartsWith("rgb", StringComparison.OrdinalIgnoreCase)
               || value.StartsWith("hsl", StringComparison.OrdinalIgnoreCase)
               || value.StartsWith("var(", StringComparison.OrdinalIgnoreCase));

    var containerClasses = "areas grid container";
    var containerStyle = string.Empty;

    if (!string.IsNullOrWhiteSpace(layoutAreaBackground))
    {
        if (IsCssColor(layoutAreaBackground))
        {
            containerStyle = $"--layout-area-bg: {layoutAreaBackground};";
        }
        else
        {
            containerClasses += $" {layoutAreaBackground}";
        }
    }
}

<div class="@containerClasses" style="@containerStyle" data-areas="@dataAreas" data-ContentUdi="@Model.ContentKey" data-Content="@Model.Content" data-GridColumns="@Model.GridColumns">
    @foreach (var area in Model.Areas)
    {
        @await Html.GetPreviewBlockGridItemAreaHtmlAsync(area)
    }
</div>
